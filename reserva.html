<!doctype html>
<html lang="es">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reserv√° tu turno ‚Äì Lavado a Domicilio</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--muted:#9ca3af;--pri:#22c55e}
  body{font-family:system-ui,Arial;background:var(--bg);color:#fff;min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center}
  .wrap{width:100%;max-width:720px;padding:20px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:18px}
  h1{margin:0 0 10px;font-size:22px}
  p{margin:0 0 14px;color:var(--muted)}
  label{display:block;margin:8px 0 6px;color:#e5e7eb;font-size:14px}
  input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #374151;background:#0b1220;color:#fff}
  .btn{margin-top:10px;display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #16a34a;background:#16a34a;color:#0b1220;font-weight:600;cursor:pointer}
  .btn.secondary{border-color:#374151;background:#111827;color:#e5e7eb}
  .slots{margin-top:10px;display:flex;flex-wrap:wrap;gap:10px}
  .slot{padding:10px 14px;border:1px solid #374151;border-radius:10px;cursor:pointer}
  .slot.sel{background:var(--pri);color:#0b1220;border-color:var(--pri);font-weight:700}
  .msg{margin-top:10px;font-size:14px}
</style>

<div class="wrap">
  <div class="card">
    <h1>Lavado a Domicilio üöó‚ú®</h1>
    <p>Eleg√≠ el d√≠a, carg√° el horario disponible y el servicio. Te confirmamos por WhatsApp.</p>

    <label>D√≠a (pr√≥ximos 14)</label>
    <select id="dia"></select>

    <button class="btn secondary" id="btnCargar">Cargar horarios</button>
    <div id="slots" class="slots"></div>

    <label>Nombre y Apellido</label>
    <input id="nombre" placeholder="Juan P√©rez">

    <label>Tel√©fono</label>
    <input id="tel" placeholder="2994...">

    <label>Direcci√≥n</label>
    <input id="dir" placeholder="Calle y n√∫mero, barrio">

    <label>Servicio</label>
    <select id="serv">
      <option>Exterior ‚Äì $15.000</option>
      <option>Interior ‚Äì $15.000</option>
      <option>Completo ‚Äì $20.000</option>
      <option>Encerado ‚Äì $12.000</option>
    </select>

    <button class="btn" id="btnSend">Reservar</button>
    <div id="msg" class="msg"></div>
  </div>
</div>

<script>
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzOBoKK8o_vP2X1vQ7WBMGx-LncMhmbe8ScEJnOZiGKVc1W5X3pnDdk_UAaae6jUZCO2Q/exec';

const $ = id => document.getElementById(id);
let horaElegida = '';

const dias = ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'];
const toISO = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
const nice  = d => `${dias[d.getDay()]} ${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}`;

async function getSlots(fechaISO){
  try {
    const r = await fetch(`${WEBAPP_URL}?action=slots&fecha=${encodeURIComponent(fechaISO)}`);
    const j = await r.json();
    return (j.ok && Array.isArray(j.slots)) ? j.slots : [];
  } catch { return []; }
}

// --- 1) Cargar SIEMPRE los pr√≥ximos 14 d√≠as (sin consultar nada) ---
function renderDiasBasico(){
  const sel = $('dia'); sel.innerHTML = '';
  const hoy = new Date(); hoy.setHours(0,0,0,0);
  for (let i=0;i<14;i++){
    const d = new Date(hoy); d.setDate(hoy.getDate()+i);
    const iso = toISO(d);
    const opt = document.createElement('option');
    opt.value = iso;
    opt.textContent = `${nice(d)} ‚Äî (cargando‚Ä¶)`;
    sel.appendChild(opt);
  }
  // selecciono el primero
  sel.value = sel.options[0]?.value || '';
}

// --- 2) Opcional: actualizar etiquetas con ‚Äú(X libres)‚Äù en segundo plano ---
async function actualizarContadores(){
  const sel = $('dia');
  for (const opt of Array.from(sel.options)){
    const slots = await getSlots(opt.value);
    opt.textContent = `${opt.textContent.split(' ‚Äî ')[0]} ‚Äî ${slots.length} libres`;
    // si quer√©s inhabilitar d√≠as sin turnos:
    // opt.disabled = slots.length === 0;
  }
}

// Bot√≥n Cargar horarios
$('btnCargar').onclick = async () => {
  $('msg').textContent = '';
  $('slots').innerHTML = '';
  const fecha = $('dia').value;
  if (!fecha){ $('msg').textContent='Eleg√≠ un d√≠a'; $('msg').style.color='salmon'; return; }

  const slots = await getSlots(fecha);
  if (!slots.length){
    $('slots').innerHTML = '<span style="color:#9ca3af">No hay horarios para ese d√≠a.</span>';
    return;
  }
  horaElegida = '';
  $('slots').innerHTML = slots.map(h => `<span class="slot" data-h="${h}">${h}</span>`).join('');
  document.querySelectorAll('.slot').forEach(el=>{
    el.onclick = () => {
      document.querySelectorAll('.slot').forEach(s=>s.classList.remove('sel'));
      el.classList.add('sel');
      horaElegida = el.dataset.h;
      $('msg').textContent = `Horario elegido: ${horaElegida}`;
      $('msg').style.color = '#22c55e';
    };
  });
};

// Reservar (GET para evitar CORS)
$('btnSend').onclick = async () => {
  $('msg').textContent = '';
  const fecha    = $('dia').value;
  const nombre   = $('nombre').value.trim();
  const telefono = $('tel').value.trim();
  const direccion= $('dir').value.trim();
  const servicio = $('serv').value.split(' ‚Äì ')[0];

  if(!fecha || !horaElegida || !nombre || !telefono || !direccion){
    $('msg').textContent = 'Complet√° d√≠a, horario, nombre, tel√©fono y direcci√≥n.';
    $('msg').style.color='salmon';
    return;
  }

  const qs = new URLSearchParams({ action:'create', fecha, hora:horaElegida, servicio, nombre, telefono, direccion }).toString();
  try{
    const res = await fetch(`${WEBAPP_URL}?${qs}`);
    const data = await res.json();
    if(data.ok){
      $('msg').textContent = '‚úÖ ¬°Turno reservado! Te confirmamos por WhatsApp.';
      $('msg').style.color = '#22c55e';
      $('slots').innerHTML = '';
      horaElegida = '';
      actualizarContadores(); // refresca cantidades
    } else {
      $('msg').textContent = data.error || 'No se pudo reservar.'; $('msg').style.color='salmon';
    }
  }catch{
    $('msg').textContent = 'Error de red al reservar.'; $('msg').style.color='salmon';
  }
};

// Inicial
renderDiasBasico();
actualizarContadores();   // se corre en segundo plano
</script>
</html>
