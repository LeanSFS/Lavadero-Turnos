<!doctype html>
<html lang="es">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reserv√° tu turno ‚Äì Lavado a Domicilio</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--muted:#9ca3af;--pri:#22c55e}
  body{font-family:system-ui,Arial;background:var(--bg);color:#fff;min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center}
  .wrap{width:100%;max-width:640px;padding:20px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:18px}
  h1{margin:0 0 10px;font-size:22px}
  p{margin:0 0 14px;color:var(--muted)}
  label{display:block;margin:8px 0 4px;color:#e5e7eb;font-size:14px}
  input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #374151;background:#0b1220;color:#fff}
  .btn{margin-top:10px;display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #16a34a;background:#16a34a;color:#0b1220;font-weight:600;cursor:pointer}
  .btn.secondary{border-color:#374151;background:#111827;color:#e5e7eb}
  .slots{margin-top:10px;display:flex;flex-wrap:wrap;gap:10px}
  .slot{padding:10px 14px;border:1px solid #374151;border-radius:10px;cursor:pointer}
  .slot.sel{background:var(--pri);color:#0b1220;border-color:var(--pri);font-weight:700}
  .msg{margin-top:10px;font-size:14px}
</style>

<div class="wrap">
  <div class="card">
    <h1>Lavado a Domicilio üöó‚ú®</h1>
    <p>Eleg√≠ fecha, horario disponible y servicio. Te confirmamos por WhatsApp.</p>

    <label>Fecha</label>
    <input type="date" id="fecha">

    <button class="btn secondary" id="btnSlots">Ver horarios disponibles</button>
    <div id="slots" class="slots"></div>

    <label>Nombre y Apellido</label>
    <input id="nombre" placeholder="Juan P√©rez">

    <label>Tel√©fono</label>
    <input id="tel" placeholder="2994...">

    <label>Direcci√≥n</label>
    <input id="dir" placeholder="Calle y n√∫mero, barrio">

    <label>Servicio</label>
    <select id="serv">
      <option>Exterior ‚Äì $15.000</option>
      <option>Interior ‚Äì $15.000</option>
      <option>Completo ‚Äì $20.000</option>
      <option>Encerado ‚Äì $12.000</option>
    </select>

    <button class="btn" id="btnSend">Reservar</button>
    <div id="msg" class="msg"></div>
  </div>
</div>

<script>
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyaoRHNzdHc3qq8pctz-TN9nCavlcGDTefvAl6UiND980Hh-SJ5XTKKfgzi5uEk3wlLPQ/exec';

const $ = (id) => document.getElementById(id);
let horaElegida = '';

$('btnSlots').onclick = async () => {
  $('msg').textContent = '';
  $('slots').innerHTML = '';
  const fecha = $('fecha').value;
  if (!fecha) { $('msg').textContent = 'Eleg√≠ una fecha'; $('msg').style.color='salmon'; return; }

  try{
    const res = await fetch(`${WEBAPP_URL}?action=slots&fecha=${encodeURIComponent(fecha)}`);
    if(!res.ok){ $('msg').textContent = 'Error al cargar horarios'; $('msg').style.color='salmon'; return; }
    const data = await res.json();
    if(!data.ok){ $('msg').textContent = data.error || 'Sin horarios'; $('msg').style.color='salmon'; return; }
    if(!data.slots.length){ $('slots').innerHTML = '<span style="color:#9ca3af">No hay horarios libres para ese d√≠a.</span>'; return; }

    horaElegida = '';
    $('slots').innerHTML = data.slots.map(h => `<span class="slot" data-h="${h}">${h}</span>`).join('');
    document.querySelectorAll('.slot').forEach(el => {
      el.onclick = () => {
        document.querySelectorAll('.slot').forEach(s=>s.classList.remove('sel'));
        el.classList.add('sel');
        horaElegida = el.dataset.h;
        $('msg').textContent = `Horario elegido: ${horaElegida}`;
        $('msg').style.color = '#22c55e';
      };
    });
  }catch(e){
    $('msg').textContent = 'Error de red'; $('msg').style.color='salmon';
  }
};

$('btnSend').onclick = async () => {
  $('msg').textContent = '';
  const fecha    = $('fecha').value;
  const nombre   = $('nombre').value.trim();
  const telefono = $('tel').value.trim();
  const direccion= $('dir').value.trim();
  const servicio = $('serv').value.split(' ‚Äì ')[0];

  if(!fecha || !horaElegida || !nombre || !telefono || !direccion){
    $('msg').textContent = 'Complet√° fecha, horario, nombre, tel√©fono y direcci√≥n.';
    $('msg').style.color='salmon';
    return;
  }

  // POST urlencoded (Apps Script lo toma en e.parameter)
  const params = new URLSearchParams();
  params.append('action','create');
  params.append('fecha', fecha);
  params.append('hora', horaElegida);
  params.append('servicio', servicio);
  params.append('nombre', nombre);
  params.append('telefono', telefono);
  params.append('direccion', direccion);

  try{
    const res  = await fetch(WEBAPP_URL, { method:'POST', body: params });
    const data = await res.json();
    if(data.ok){
      $('msg').textContent = '‚úÖ ¬°Turno reservado! Te confirmamos por WhatsApp.';
      $('msg').style.color = '#22c55e';
      $('slots').innerHTML = '';
      horaElegida = '';
      // Si quer√©s notificaci√≥n a tu WhatsApp, descoment√° y pon√© tu n√∫mero:
      // const texto = `Nuevo turno: ${nombre} (${telefono}) | ${servicio} | ${fecha} ${params.get('hora')} | ${direccion}`;
      // window.open(`https://wa.me/5492990000000?text=${encodeURIComponent(texto)}`, '_blank');
    } else {
      $('msg').textContent = data.error || 'No se pudo reservar.';
      $('msg').style.color='salmon';
    }
  }catch(e){
    $('msg').textContent = 'Error de red al reservar.'; 
    $('msg').style.color='salmon';
  }
};
</script>
</html>

